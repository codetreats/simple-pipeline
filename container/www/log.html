<!doctype html>
<meta charset="utf-8">
<title>Logviewer</title>
<style>
  :root{ --bg:#fff; --fg:#111; --muted:#666; --border:#ddd }
  body{ margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:var(--bg); color:var(--fg) }
  header{ padding:.6rem .9rem; background:#f5f5f5; border-bottom:1px solid var(--border); display:flex; gap:.6rem; align-items:center; flex-wrap:wrap }
  pre#log{ margin:0; height: calc(100vh - 56px); overflow:auto; padding:10px; background:#fff; border-top:1px solid var(--border); white-space:pre-wrap }
  .muted{ color:var(--muted) }
  input,button{ font:inherit; padding:.3rem .5rem; border:1px solid var(--border); border-radius:6px; background:#fff }
</style>
<pre id="log"></pre>
<script>
  const qs = new URLSearchParams(location.search);
  const file = qs.get('file') || 'error.log'; 
  document.getElementById('log').textContent = file;

  const el = document.getElementById('log');
  function atBottom(){ return (el.scrollTop + el.clientHeight) >= (el.scrollHeight - 8); }
  function toBottom(){ el.scrollTop = el.scrollHeight; }

  const url = 'tail.php?file=' + encodeURIComponent(file);
  const es = new EventSource(url);

  es.addEventListener('init', e => { el.textContent = JSON.parse(e.data); toBottom(); document.getElementById('status').textContent = 'verbunden'; });
  es.addEventListener('rotate', () => {  });
  es.onmessage = e => { const stick = atBottom(); el.textContent += JSON.parse(e.data); if (stick) toBottom(); };
  es.onerror = () => { document.getElementById('status').textContent = 'Verbindung unterbrochen – retry…'; };
</script>
